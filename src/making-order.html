{% set title = "Оформление заказа" %}

{% extends "layouts/default.html" %}

{% block content %}

  <main>
    <form id="saveOrder" action="#saveOrder"></form>
    <section class="making-order section">
      <div class="container">
        <div class="making-order__title-box">
          <h1 class="title">Оформление заказа</h1>
          <a class="making-order__back-link">
            <svg class="delivery__back-icon">
              <use xlink:href="#icon-back"></svg>
              <span class="delivery__back-text">Вернуться в корзину</span>
            </a>
          </div>

      <div class="making-order__box">

        <div class="making-order__content">
          <div class="making-order__cart">
            <h2 class="making-order__subtitle">Состав заказа</h2>
            <hr class="cart__divider">
            <ul class="making-order__cart-list">

              {% for item in productsCards %}

              <div class="cart__item">
                <a href="" class="cart__item-info">
                  {% if not item.img %}
                  {{ 'assets/img/no-image.jpg' | picture( "Изображение на товар отсуствует", 'cart__item-image
                  no-img')|safe}}
                  {% else %}
                  <div class="card__img-box">
                    {{ item.img | picture(alt, 'cart__item-image') | safe }}
                  </div>
                  {% endif %}
                  <div class="cart__item-details">
                    <div class="cart__item-name">{{ item.title }}</div>
                    <p class="cart__item-weight">{{ item.weight }}</p>
                    <p class="cart__item-sku">Арт: {{ item.sku or 'Не указан' }}</p>
                  </div>
                </a>
                <div class="cart__price">
                  <div class="cart__item-price-box">
                    <span class="cart__item-quantity-value">{{ item.quantity or 1 }} шт.</span>

                    {% if item.quantity > 1 %}
                    <p class="cart__item-price-one">
                      {{ item.price }} / шт.
                    </p>
                    {% endif %}
                  </div>

                  {% if item.oldPrice %}
                  <div class="card__price-box ">
                    <p class="card__price card__price--new">
                      {{item.price}}
                    </p>
                    <p class="card__old-price">
                      {{item.oldPrice}}
                    </p>
                  </div>
                  {% else %}

                  <div class="card__price-box">
                    <p class="card__price">
                      {{item.price}}
                    </p>
                  </div>
                  {% endif %}
                </div>

              </div>

              <hr class="cart__divider">
              {% endfor %}

            </ul>
          </div>

          <div class="making-order__delivery">
            <h2 class="making-order__subtitle">
              Способ получения
            </h2>
            <div class="making-order__delivery-box">
              <div class="making-order__tabs">
                <input type="radio" id="tab-making-order-pickup" name="delivery-type" value="pickup" class="making-order__tab-input"
                  checked>
                <input type="radio" id="tab-making-order-delivery" name="delivery-type" value="delivery" class="making-order__tab-input">

                    <div class="making-order__toggle">
                      <label for="tab-making-order-pickup" class="making-order__toggle-btn">Самовывоз</label>
                      <label for="tab-making-order-delivery" class="making-order__toggle-btn">Доставка курьером</label>
                    </div>

                    <div class="making-order__tab-content making-order__pickup-content">
                      <div class="making-order__city-box">
                        <div class="making-order__city-title-box">
                          <p class="making-order__city-title">
                            Адрес самовывоза
                        </p>
                          <button class="making-order__city-button">
                          Изменить
                        </button>
                        </div>
                        <div class="making-order__city-selector">
                          <div class="making-order__address-box">
                            <img class="delivery__marker" src="assets/img/overlay-marker.png" alt="маркет">
                            <p class="making-order__address-info">
                              <span class="making-order__address-text">г. Москва, ул Малая Бронная, д. 41</span>
                              <span class="making-order__working-hours">Сегодня с 09:00 до 18:00</span>
                            </p>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="making-order__tab-content making-order__delivery-content">
                      <div class="making-order__city-box">
                        <div class="making-order__city-title-box">
                          <p class="making-order__city-title">
                            Адрес доставки
                        </p>
                          <button class="making-order__city-button">
                          Изменить
                        </button>
                        </div>
                        <div class="making-order__city-selector">
                          <div class="making-order__address-box">
                            <img class="delivery__marker" src="assets/img/overlay-marker.png" alt="маркет">
                            <p class="making-order__address-info">
                              <span class="making-order__address-text">г. Москва, ул Малая Бронная, д. 41</span>

                            </p>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="making-order__payment">
                <h2 class="making-order__subtitle">
                  Способ оплаты
                </h2>
                <div class="making-order__payment-box">
                  <div class="making-order__tabs">
                    <input type="radio" id="tab-making-payment-online" name="payment-type" class="making-order__tab-input" checked>
                    <input type="radio" id="tab-making-payment-sbp" name="payment-type" class="making-order__tab-input">

                    <div class="making-order__toggle">
                      <label for="tab-making-payment-online" class="making-order__payment-toggle">Картой онлайн
                        <img src="assets/img/kassa.png" alt="Юкасса">
                      </label>
                      <label for="tab-making-payment-sbp" class="making-order__payment-toggle">СБП
                        <img src="assets/img/sbp.png" alt="СБП">
                      </label>
                    </div>

                  </div>
                </div>
              </div>

              <div class="making-order__recipient">
                <h2 class="making-order__subtitle">
                  Данные получателя
                </h2>

                <div class="making-order__recipient-box">
                  <label for="order-recipient">
                    <input form="saveOrder" name="order-recipient" id="order-recipient" required type="text" class="delivery__form-input making-order__recipient-input" placeholder="ФИО *">
                  </label>
                  <label for="order-email">
                    <input form="saveOrder" name="order-email" id="order-email" required type="email" class="delivery__form-input making-order__recipient-input" placeholder="Email *">
                  </label>
                  <label for="order-phone">
                    <input form="saveOrder" name="order-phone" id="order-phone" required type="tel" class="delivery__form-input making-order__recipient-input" placeholder="Телефон *">
                  </label>
                </div>
              </div>
            </div>

        <aside class="cart__summary-column making-order__summary">
          <div class="cart__summary-box cart__promo-box">
            <h3 class="cart__promo-title">Промокод</h3>
            <div class="cart__promo-input">
              <svg class="promo-icon" width="24" height="24">
                <use href="#promo-icon"></use>
              </svg>
              <input form="saveOrder" class="cart__promo-input-field" type="text" placeholder="Введите промокод">
            </div>
          </div>

          <div class="cart__loader-wrapper">
            <div class="cart__loader" style="display: none;">
              <svg class="cart__loader-icon" width="24" height="24">
                <use href="#spinner-icon"></use>
              </svg>
            </div>

            <div class="cart__summary-box cart__summary-box--price">
              <div class="cart__order-summary">
                <div class="cart__summary-row">
                  <span class="cart__summary-text">Товары ({{ productsCards.length }})</span>
                  <span class="cart__summary-text">5 000 ₽</span>
                </div>
                <div class="cart__summary-row">
                  <span class="cart__summary-text">Доставка</span>
                  <span class="cart__summary-text">1 200 ₽</span>
                </div>

                <div class="cart__discount-row">
                  <span class="cart__discount-text">Скидка</span>
                  <span class="cart__discount-text">-2 000 ₽</span>
                </div>
                <div class="cart__discount-row cart__discount-row--promo" style="display: none;">
                  <span class="cart__discount-text">Скидка по промокоду</span>
                  <span class="cart__discount-text">- 500 ₽</span>
                </div>

                <div class="cart__summary-row cart__summary-row--total">
                  <strong class="cart__summary-total">Итого</strong>
                  <strong class="cart__summary-total">2 500 ₽</strong>
                </div>
              </div>
              <div class="cart__checkout-box">
                <button form="saveOrder" disabled type="submit" id="checkout-submit-btn" class="cart__checkout-btn btn">Оформить
                  заказ</button>
                <div class="cart__checkout-check">
                  <label class="cart__checkbox-control cart__item-checkbox">
                    <span class="custom-checkbox">
                      <input form="saveOrder" id="agreePolicy" required class="custom-checkbox__input" type="checkbox">
                      <span class="custom-checkbox__box"></span>
                    </span>
                    <span class="cart__checkout-text">Я согласен с политикой <a href="http://"
                        target="_blank">конфиденциальности и офертой</a>
                    </span>
                  </label>
                  <label class="cart__checkbox-control cart__item-checkbox">
                    <span class="custom-checkbox">
                      <input form="saveOrder" checked class="custom-checkbox__input" type="checkbox">
                      <span class="custom-checkbox__box"></span>
                    </span>
                    <span class="cart__checkout-text">Я согласен получать рекламные материалы от Дары Юга</a>
                    </span>
                  </label>
                </div>
              </div>
            </div>
          </div>
        </aside>

      </div>
    </div>
  </section>
  <div class="overlay-delivery-modal hidden"> // моё
    <section id="delivery-options" class="delivery delivery--section">
      <div class="delivery__container">
        <aside class="delivery__options-panel">
          <div class="delivery__options-content">
            <header class="delivery__options-header">
              <p class="delivery__title">Способ получения</p>
              <a class="delivery__back-link">
                <svg class="delivery__back-icon">
                  <use xlink:href="#icon-back"></use>
                </svg>
                <span class="delivery__back-text">Назад</span>
              </a>
            </header>
            <div class="delivery__tabs">
              <input form="saveOrder" type="radio" id="tab-pickup" name="delivery-type" class="delivery__tab-input" value="pickup" checked>
              <input form="saveOrder" type="radio" id="tab-delivery" name="delivery-type" class="delivery__tab-input" value="delivery">
              <div class="delivery__toggle">
                <label for="tab-pickup" class="delivery__toggle-btn">Самовывоз</label>
                <label for="tab-delivery" class="delivery__toggle-btn">Доставка</label>
              </div>
              <div class="delivery__form-group">
                <label for="city-input" class="delivery__form-label">Город</label>
                <div class="delivery__city-selector">
                  <div class="delivery__city-info">
                    <svg class="delivery__city-icon">
                      <use xlink:href="#icon-map-pin"></use>
                    </svg>
                    <span class="delivery__city-name">Москва</span>
                  </div>
                  <a href="#" class="delivery__change-link delivery__change-link--active" data-toggle="city-modal">
                    Изменить
                  </a>
                </div>
              </div>
              <!-- /// самовывоз -->
              <div class="delivery__form-sections delivery__tab-content delivery__pickup-content">
                <div class="delivery__fairs-section">
                  <h2 class="delivery__fairs-title">Доступные ярмарки</h2>
                  <ul class="delivery__fairs-list" id="pickup-points-list">
                    <!-- Адреса будут вставлены сюда через JS -->
                  </ul>
                </div>
              </div>
              <!-- ///доставка -->
              <form class="delivery__form delivery__tab-content delivery__delivery-content">
                <div class="delivery__form-group">
                  {% set inputName = "" %}
                  <div class="delivery__details">
                    <label class="delivery__form-label-title">Данные для доставки</label>
                    <div class="delivery__input-group">
                      <label for="address" class="delivery__form-label">Адрес*</label>
                      <input form="saveOrder" value="{{inputName}}" required type="text" id="address" class="delivery__form-input"
                        placeholder="Улица, номер дома">


                      <!--  -->
                      <ul class="suggestions" id="suggestions">
                      </ul>
                      <!--  -->
                    </div>
                    <div class="delivery__input-row">
                      <div class="delivery__input-group">
                        <label for="apartment" class="delivery__form-label">Кв/офис</label>
                        <input form="saveOrder" type="text" id="apartment" class="delivery__form-input" placeholder="">
                      </div>
                      <div class="delivery__input-group">
                        <label for="entrance" class="delivery__form-label">Подъезд</label>
                        <input form="saveOrder" type="text" id="entrance" class="delivery__form-input" placeholder="">
                      </div>
                      <div class="delivery__input-group">
                        <label for="floor" class="delivery__form-label">Этаж</label>
                        <input form="saveOrder" type="text" id="floor" class="delivery__form-input" placeholder="">
                      </div>
                      <div class="delivery__input-group">
                        <label for="intercom" class="delivery__form-label">Домофон</label>
                        <input form="saveOrder" type="text" id="intercom" class="delivery__form-input" placeholder="">
                      </div>
                    </div>
                    <div class="delivery__input-group">
                      <label for="comment" class="delivery__form-label">Комментарий к заказу</label>
                      <input form="saveOrder" type="text" id="comment" class="delivery__form-input">
                    </div>
                  </div>
                  {% if inputName == "Москва" %}
                  <div class="delivery__price-block">
                    <p class="delivery__price-title">Стоимость доставки</p>
                    <p class="delivery__price">1 200 ₽</p>
                  </div>
                  {% endif %}
                  {% if inputName != "Москва" and inputName != "" %}
                  <div class="delivery__error">
                    <svg class="delivery__attention-icon">
                      <use xlink:href="#icon-attention"></use>
                    </svg>
                    <p class="delivery__error-text">
                      Адрес не входит в зону доставки. Укажите другой адрес или выберите другой способ получения
                    </p>
                  </div>
                  <div class="delivery__price-block">
                    <p class="delivery__price-title">Стоимость доставки</p>
                    <p class="delivery__price delivery__price--error">0 ₽</p>
                  </div>
                  {% endif %}
                  {% if inputName == "" %}
                  {% endif %}
                </div>
                <div class="delivery__form-btn">
                  <button disabled id="submit-btn" form="delivery-form" type="submit" class="delivery__btn-submit">
                    Далее
                  </button>
                </div>
              </form>
            </div>
          </div>

          <button class="delivery__map-btn delivery__map-btn--open">
            Показать на карте
          </button>

          {% include 'includes/overlay-delivery.html' %}
        </aside>
        <div class="delivery__map-container">
          <div id="map">
          </div>
          <button class="delivery__map-btn delivery__map-btn--close">
            Показать списком
          </button>
        </div>
      </div>
    </section>
  </div>
</main>
{% endblock %}